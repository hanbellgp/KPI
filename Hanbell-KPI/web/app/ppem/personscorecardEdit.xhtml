<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../WEB-INF/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:define name="content">
        <style>
            .scoreInputNumber{
                text-align:left !important;
            }
        </style>
        <h:form id="formOne">
            <p:growl id="growl"  showSummary="false" showDetail="true" />
              <p:growl   showSummary="false" showDetail="true" />
            <p:toolbar id="toolbar" styleClass="topToolbar">
                <f:facet name="left">
                    <p:commandButton id="btnReturn" value="返回"  icon="ui-icon-restore" action="#{personScorecardManagedBean.returnPage('personscorecard')}"/>
                </f:facet>
            </p:toolbar>
            <p:panelGrid id="plgHead" styleClass="plgHead Wid100">
                <f:facet name="header">
                    <p:row>
                        <p:column colspan="4">员工考核评分--编辑</p:column>
                    </p:row>
                </f:facet>
                <p:row>
                    <p:column styleClass="Wid20"><p:outputLabel value="工号" for="userid"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="userid" value="#{personScorecardManagedBean.currentEntity.userid}" title="工号"/>
                    </p:column>
                    <p:column styleClass="Wid20"><p:outputLabel value="名字" for="username"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="username" value="#{personScorecardManagedBean.currentEntity.username}" title="名字"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column styleClass="Wid20"><p:outputLabel value="年份" for="year"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="year" value="#{personScorecardManagedBean.currentEntity.year}" title="工号"/>
                    </p:column>
                    <p:column styleClass="Wid20"><p:outputLabel value="类型" for="type"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="type" value="#{personScorecardManagedBean.currentEntity.personset.type}" title="类型"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column styleClass="Wid20"><p:outputLabel value="部门" for="deptno"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="deptno" value="#{personScorecardManagedBean.currentEntity.personset.deptno}" title="部门"/>
                    </p:column>
                    <p:column styleClass="Wid20"><p:outputLabel value="部门名称" for="deptname"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="deptname" value="#{personScorecardManagedBean.currentEntity.personset.deptname}" title="部门名称"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column styleClass="Wid20"><p:outputLabel value="职等" for="officialrank"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="officialrank" value="#{personScorecardManagedBean.currentEntity.personset.officialrank}" title="职等"/>
                    </p:column>
                    <p:column styleClass="Wid20"><p:outputLabel value="岗位" for="duties"/></p:column>
                    <p:column styleClass="Wid30">
                        <p:outputLabel id="duties" value="#{personScorecardManagedBean.currentEntity.personset.duties}" title="岗位"/>
                    </p:column>
                </p:row>
            </p:panelGrid>
            <!--Q1-->
            <p:tabView id="tabView" styleClass="tabView">
                <p:ajax event="tabChange" listener="#{personScorecardManagedBean.tabchange}"  update="formOne"></p:ajax>
                <p:tab title="Q1主观" id="sq1">
                    <c:if test="#{personScorecardManagedBean.queryQuarter==1}">
                        <p:toolbar  styleClass="detailToolbar ">
                            <f:facet name="right">
                                <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check"
                                                  process="@this,formOne:tabView:tableList1" update="formOne:growl,tableList1 "/>
                            </f:facet>
                        </p:toolbar>
                    </c:if>
                    <p:dataTable id="tableList1" value="#{personScorecardManagedBean.scoreMap.get('sq1').detail}" var="item" styleClass="tableList Mtop10">
                        
                        <p:column styleClass="Wid5" >
                            <f:facet name="header">
                                <h:outputText value="项目"/>
                            </f:facet>
                            <h:outputFormat >
                                <h:outputText value="#{item.name}" />
                            </h:outputFormat>
                        </p:column>
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="单项分数"/>
                            </f:facet>
                            <p:inputNumber  value="#{item.hunscore}"  readonly="#{personScorecardManagedBean.queryQuarter>1}" style="float:right!important" onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList1" oncomplete="selectall();"></p:ajax>
                            </p:inputNumber >
                        </p:column>
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="比重"/>
                            </f:facet>
                            <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                        </p:column>
                        <p:column styleClass="Wid5">
                              <f:facet name="header">
                                <h:outputText value="权重分数"/>
                            </f:facet>
                            <h:outputText value="#{item.score}"   id="score1">
                            </h:outputText>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                            <h:outputText value="#{personScorecardManagedBean.scoreMap.get('sq1').quarter*100}%" />
                        </p:column> 
                        
                        <p:columnGroup type="footer">
                                <p:column style="text-align:left" footerText="Totals:" colspan="3"/>
                                <p:column style="text-align:left"  >
                                    <f:facet name="footer" >
                                        <h:outputText value="#{personScorecardManagedBean.currentEntity.subjectivity1}" />
                                    </f:facet>
                                </p:column>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText    value="#{personScorecardManagedBean.currentEntity.subjectivitypro1}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                        </p:columnGroup>
                    </p:dataTable>
                </p:tab>
                <c:if test="#{'I'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod()) or 'J'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod())}">
                    <p:tab title="Q1客观" id="aq1">
                        <c:if test="#{personScorecardManagedBean.queryQuarter==1}">
                            <p:toolbar  styleClass="detailToolbar">
                                <f:facet name="right">
                                    <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check"
                                                      process="@this,formOne:tabView:tableList2" update="formOne:growl,tableList2"/>
                                </f:facet>
                            </p:toolbar>
                        </c:if>
                        <p:dataTable id="tableList2" value="#{personScorecardManagedBean.scoreMap.get('aq1').detail}" var="item" styleClass="tableList Mtop10">
                            <p:column styleClass="Wid5" groupRow="true" style="text-align:center;background: white !important">
                                <f:facet name="header">
                                    <h:outputText value="考核项目"/>
                                </f:facet>
                                <h:outputText value="#{item.name}"/>
                            </p:column>
                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="目标"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.target}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>
                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="考核标准"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.standard}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="单项分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.hunscore}"  inputStyleClass="scoreInputNumber"   readonly="#{personScorecardManagedBean.queryQuarter>1}" onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList2" oncomplete="selectall();"></p:ajax>
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="比重"/>
                                </f:facet>
                                <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="权重分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.score}"  inputStyleClass="scoreInputNumber"   readonly="true">
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                                <h:outputText value="#{personScorecardManagedBean.scoreMap.get('aq1').quarter*100}%" />
                            </p:column> 
                            <p:columnGroup type="footer">
                                <p:row>
                                    <p:column style="text-align:left" footerText="Totals:" colspan="5"/>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objective1}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText  value="#{personScorecardManagedBean.currentEntity.objectivepro1}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>
                        </p:dataTable>
                    </p:tab>
                </c:if>
                Q2
                <p:tab title="Q2主观" id="sq2">
                    <c:if test="#{personScorecardManagedBean.queryQuarter==2}">
                        <p:toolbar  styleClass="detailToolbar">
                            <f:facet name="right">
                                <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check"
                                                  process="@this tableList3" update="formOne:growl,tableList3"/>
                            </f:facet>
                        </p:toolbar>
                    </c:if>
                    <p:dataTable id="tableList3" value="#{personScorecardManagedBean.scoreMap.get('sq2').detail}" var="item" styleClass="tableList Mtop10"  >
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="项目"/>
                            </f:facet>
                            <h:outputText value="#{item.name}"/>
                        </p:column>
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="单项分数"/>
                            </f:facet>
                            <p:inputNumber  value="#{item.hunscore}"  inputStyleClass="scoreInputNumber"   readonly="#{personScorecardManagedBean.queryQuarter>2}" onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList3" oncomplete="selectall();"></p:ajax>
                            </p:inputNumber >
                        </p:column>
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="比重"/>
                            </f:facet>
                            <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重分数">
                            <p:inputNumber value="#{item.score}"  readonly="true" inputStyleClass="scoreInputNumber"  >
                            </p:inputNumber>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                            <h:outputText value="#{personScorecardManagedBean.scoreMap.get('sq2').quarter*100}%" />
                        </p:column> 
                        <p:columnGroup type="footer">
                            <p:row>
                                <p:column style="text-align:left" footerText="Totals:" colspan="3"/>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText value="#{personScorecardManagedBean.currentEntity.subjectivity2}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText value="#{personScorecardManagedBean.currentEntity.subjectivitypro2}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                            </p:row>
                        </p:columnGroup>
                    </p:dataTable>
                </p:tab>
                <c:if test="#{'I'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod()) or 'J'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod())}">
                    <p:tab title="Q2客观" id="aq2">
                        <c:if test="#{personScorecardManagedBean.queryQuarter==2}">
                            <p:toolbar  styleClass="detailToolbar">
                                <f:facet name="right">
                                    <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check"
                                                      process="@this tableList4" update="formOne:growl,tableList4"/>
                                </f:facet>
                            </p:toolbar>
                        </c:if>
                        <p:dataTable id="tableList4"  value="#{personScorecardManagedBean.scoreMap.get('aq2').detail}"  var="item" styleClass="tableList Mtop10" >
                            <p:column styleClass="Wid10" groupRow="true" style="text-align:center;background: white !important">
                                <f:facet name="header">
                                    <h:outputText value="考核项目"/>
                                </f:facet>
                                <h:outputText value="#{item.name}"/>
                            </p:column>
                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="目标"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.target}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>
                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="考核标准"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.standard}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="单项分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.hunscore}"  inputStyleClass="scoreInputNumber"   readonly="#{personScorecardManagedBean.queryQuarter>2}" onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList4" oncomplete="selectall();"></p:ajax>
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="比重"/>
                                </f:facet>
                                <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="权重分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.score}"  inputStyleClass="scoreInputNumber"   readonly="true">
                                </p:inputNumber>
                            </p:column>
                            <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                                <h:outputText value="#{personScorecardManagedBean.scoreMap.get('aq2').quarter*100}%" />
                            </p:column> 
                            <p:columnGroup type="footer">
                                <p:row>
                                    <p:column style="text-align:left" footerText="Totals:" colspan="5"/>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objective2}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objectivepro2}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>
                        </p:dataTable>
                    </p:tab>
                </c:if>
                Q3
                <p:tab title="Q3主观" id="sq3">
                    <c:if test="#{personScorecardManagedBean.queryQuarter==3}">
                        <p:toolbar  styleClass="detailToolbar">
                            <f:facet name="right">
                                <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check" 
                                                  process="@this,formOne:tabView:tableList5" update="formOne:growl,tableList5"/>
                            </f:facet>
                        </p:toolbar>
                    </c:if>
                    <p:dataTable id="tableList5" value="#{personScorecardManagedBean.scoreMap.get('sq3').detail}" var="item" styleClass="tableList Mtop10"  >
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="项目"/>
                            </f:facet>
                            <h:outputText value="#{item.name}"/>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="单项分数">
                            <p:inputNumber value="#{item.hunscore}"  readonly="#{personScorecardManagedBean.queryQuarter>3}" inputStyleClass="scoreInputNumber"  onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList5" oncomplete="selectall();"></p:ajax>
                            </p:inputNumber>
                        </p:column>
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="比重"/>
                            </f:facet>
                            <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重分数">
                            <p:inputNumber value="#{item.score}"  readonly="true" inputStyleClass="scoreInputNumber"  >
                            </p:inputNumber>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                            <h:outputText value="#{personScorecardManagedBean.scoreMap.get('sq3').quarter*100}%" />
                        </p:column> 
                        <p:columnGroup type="footer">
                            <p:row>
                                <p:column style="text-align:left" footerText="Totals:" colspan="3"/>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText value="#{personScorecardManagedBean.currentEntity.subjectivity3}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText value="#{personScorecardManagedBean.currentEntity.subjectivitypro3}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                            </p:row>
                        </p:columnGroup>
                    </p:dataTable>
                </p:tab>
                <c:if test="#{'I'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod()) or 'J'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod())}">
                    <p:tab title="Q3客观" id="aq3">
                        <c:if test="#{personScorecardManagedBean.queryQuarter==3}">
                            <p:toolbar  styleClass="detailToolbar">
                                <f:facet name="right">
                                    <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check" 
                                                      process="@this,formOne:tabView:tableList6" update="formOne:growl,tableList6"/>
                                </f:facet>
                            </p:toolbar>
                        </c:if>
                        <p:dataTable id="tableList6" value="#{personScorecardManagedBean.scoreMap.get('aq3').detail}" var="item" styleClass="tableList Mtop10" >
                            <p:column styleClass="Wid10" groupRow="true" style="text-align:center;background: white !important">
                                <f:facet name="header">
                                    <h:outputText value="考核项目"/>
                                </f:facet>
                                <h:outputText value="#{item.name}"/>
                            </p:column>
                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="目标"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.target}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>

                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="考核标准"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.standard}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="单项分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.hunscore}"  inputStyleClass="scoreInputNumber"  readonly="#{personScorecardManagedBean.queryQuarter>3}" onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList6" oncomplete="selectall();"></p:ajax>
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="比重"/>
                                </f:facet>
                                <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="权重分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.score}"  inputStyleClass="scoreInputNumber"  readonly="true" >
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                                <h:outputText value="#{personScorecardManagedBean.scoreMap.get('aq3').quarter*100}%" />
                            </p:column> 
                            <p:columnGroup type="footer">
                                <p:row>
                                    <p:column style="text-align:left" footerText="Totals:" colspan="5"/>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objective3}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objectivepro3}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>
                        </p:dataTable>
                    </p:tab>
                </c:if>

                Q4
                <p:tab title="Q4主观" id="sq4">
                    <c:if test="#{personScorecardManagedBean.queryQuarter==4}">
                        <p:toolbar  styleClass="detailToolbar">
                            <f:facet name="right">
                                <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check" 
                                                  process="@this,formOne:tabView:tableList7" update="formOne:growl,tableList7"/>
                            </f:facet>
                        </p:toolbar>
                    </c:if>
                    <p:dataTable id="tableList7"  value="#{personScorecardManagedBean.scoreMap.get('sq4').detail}" var="item" styleClass="tableList Mtop10"  >
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="项目"/>
                            </f:facet>
                            <h:outputText value="#{item.name}"/>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="单项分数">
                            <p:inputNumber value="#{item.hunscore}"  readonly="#{personScorecardManagedBean.queryQuarter>4}" inputStyleClass="scoreInputNumber"   onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList7" oncomplete="selectall();"></p:ajax>
                            </p:inputNumber>
                        </p:column>
                        <p:column styleClass="Wid5">
                            <f:facet name="header">
                                <h:outputText value="比重"/>
                            </f:facet>
                            <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重分数">
                            <p:inputNumber value="#{item.score}"  readonly="true" inputStyleClass="scoreInputNumber"  >
                            </p:inputNumber>
                        </p:column>
                        <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                            <h:outputText value="#{personScorecardManagedBean.scoreMap.get('sq4').quarter*100}%" />
                        </p:column> 
                        <p:columnGroup type="footer">
                            <p:row>
                                <p:column style="text-align:left" footerText="Totals:" colspan="3"/>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText value="#{personScorecardManagedBean.currentEntity.subjectivity4}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                                <p:column style="text-align:left">
                                    <f:facet name="footer">
                                        <h:outputText  value="#{personScorecardManagedBean.currentEntity.subjectivitypro4}">
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                            </p:row>
                        </p:columnGroup>
                    </p:dataTable>
                </p:tab>
                <c:if test="#{'I'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod()) or 'J'.equals(personScorecardManagedBean.currentEntity.personset.getAssessmentmethod())}">
                    <p:tab title="Q4客观" id="aq4">
                        <c:if test="#{personScorecardManagedBean.queryQuarter==4}">
                            <p:toolbar  styleClass="detailToolbar">
                                <f:facet name="right">
                                    <p:commandButton  value="保存" actionListener="#{personScorecardManagedBean.update()}" icon="ui-icon-check" 
                                                      process="@this,formOne:tabView:tableList8" update="formOne:growl,tableList8"/>
                                </f:facet>
                            </p:toolbar>
                        </c:if>
                        <p:dataTable id="tableList8"  value="#{personScorecardManagedBean.scoreMap.get('aq4').detail}" var="item" styleClass="tableList Mtop10" >
                            <p:column styleClass="Wid10" groupRow="true" style="text-align:center;background: white !important">
                                <f:facet name="header">
                                    <h:outputText value="考核项目"/>
                                </f:facet>
                                <h:outputText value="#{item.name}"/>
                            </p:column>
                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="目标"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.target}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>

                            <p:column styleClass="Wid10">
                                <f:facet name="header">
                                    <h:outputText value="考核标准"/>
                                </f:facet>
                                <p:inputTextarea  value="#{item.standard}" styleClass="Wid100"  rows="3" readonly="true"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="单项分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.hunscore}"  inputStyleClass="scoreInputNumber"  readonly="#{personScorecardManagedBean.queryQuarter>4}"  onkeydown="return handleEnter(event, this)">
                                <p:ajax listener="#{personScorecardManagedBean.setScore}" update="tableList8" oncomplete="selectall();"></p:ajax>
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="比重"/>
                                </f:facet>
                                <h:outputText value="#{personScorecardManagedBean.formatPercentage(item.ratio*100)}%"/>
                            </p:column>
                            <p:column styleClass="Wid5">
                                <f:facet name="header">
                                    <h:outputText value="权重分数"/>
                                </f:facet>
                                <p:inputNumber  value="#{item.score}"  inputStyleClass="scoreInputNumber"  readonly="true" >
                                </p:inputNumber >
                            </p:column>
                            <p:column styleClass="Wid5" headerText="权重" groupRow="true" style="text-align:center">
                                <h:outputText value="#{personScorecardManagedBean.scoreMap.get('aq4').quarter*100}%" />
                            </p:column> 
                            <p:columnGroup type="footer">
                                <p:row>
                                    <p:column style="text-align:left" footerText="Totals:" colspan="5"/>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objective4}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                    <p:column style="text-align:left">
                                        <f:facet name="footer">
                                            <h:outputText value="#{personScorecardManagedBean.currentEntity.objectivepro4}">
                                            </h:outputText>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>
                        </p:dataTable>
                    </p:tab>
                </c:if>
            </p:tabView>
            <script type="text/javascript">
                function handleEnter(event, currentInput) {
                    if (event.keyCode == 13) { // Enter key
                        var currentRow = currentInput.closest('tr');
                        var nextRow = currentRow.nextElementSibling;
                        if (nextRow) {
                            var nextInput = nextRow.querySelector('input');
                            if (nextInput) {
                                nextInput.focus();
                            }
                        }else{
                           document.activeElement.blur();
                        }
                        return false; // 阻止默认回车行为
                    }
                    return true;
                };
                function selectall(){
                    var currentFocus = document.activeElement;
                    if (currentFocus &amp;&amp; currentFocus.tagName.toLowerCase() == 'input') {
                        currentFocus.select();
                      }else{
                          document.activeElement.blur();
                      }
                }
            </script>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>
            <p:blockUI id="blockUI" block="formOne" trigger="">
                <p:graphicImage name="images/ajaxloadingbar.gif" library="ultima-layout"/>
            </p:blockUI>
        </h:form>
    </ui:define>
</ui:composition>
